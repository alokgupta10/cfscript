import subprocess
import boto3

def lambda_handler(event, context):
    # Replace with your EC2 instance IP or hostname
    ec2_instance_ip = "your_ec2_instance_ip"

    # Run Nmap scan
    nmap_output = subprocess.check_output(["nmap", "-p", "80", ec2_instance_ip])

    # Run Nikto scan
    nikto_output = subprocess.check_output(["nikto", "-h", ec2_instance_ip])

    # Create separate CSV files for Nmap and Nikto output
    nmap_csv_output = f"Nmap Output:\n{nmap_output.decode()}"
    nikto_csv_output = f"Nikto Output:\n{nikto_output.decode()}"

    # Upload Nmap CSV to S3
    s3 = boto3.client("s3")
    nmap_bucket_name = "your-nmap-s3-bucket"
    nmap_object_key = "nmap_scan.csv"
    s3.put_object(Bucket=nmap_bucket_name, Key=nmap_object_key, Body=nmap_csv_output)

    # Upload Nikto CSV to S3
    nikto_bucket_name = "your-nikto-s3-bucket"
    nikto_object_key = "nikto_scan.csv"
    s3.put_object(Bucket=nikto_bucket_name, Key=nikto_object_key, Body=nikto_csv_output)

    return {
        "statusCode": 200,
        "body": "Vulnerability scans completed and CSV files uploaded to S3."
    }
